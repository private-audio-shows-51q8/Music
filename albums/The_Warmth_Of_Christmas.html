<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex, nofollow">
<title>The Warmth Of Christmas</title>

<style>
body {
  background:#111;
  color:#eee;
  font-family:Arial, sans-serif;
  text-align:center;
  font-size:clamp(14px, 2vw, 18px);
  margin:0;
}

.album {
  max-width:90%;
  margin:auto;
  padding:10px;
}

.cover {
  width:100%;
  max-width:500px;
  border-radius:10px;
}

/* Tablets */
@media (min-width: 600px) {
  .cover {
    max-width:400px;
  }
}

/* Ordenadores */
@media (min-width: 1024px) {
  .cover {
    max-width:300px;
  }
}

.album-title {
  font-size: 110%; /* ~20% más grande que antes */
  margin-top: 10px;
}

/* LISTADO DE CANCIONES */
.track {
  display:flex;
  align-items:center;
  cursor:pointer;
  padding:8px 4px;
  border-bottom:1px solid #333;
}

.track:hover {
  background:#222;
}

.track-info {
  display:flex;
  align-items:center;
  gap:10px;
  flex:1;
}

.track img {
  width:40px;
  height:40px;
  border-radius:6px;
  object-fit:cover;
}

.track-title {
  text-align:left;
  font-weight:bold; /* títulos en negrita */
}

/* Botón de descarga */
.download-btn {
  display:flex;
  align-items:center;
  justify-content:center;
  width:32px;
  height:32px;
  margin-left:8px;
  margin-right:4px;
  border-radius:50%;
  border:none;
  background:transparent;
  cursor:pointer;
}

.download-btn svg {
  width:20px;
  height:20px;
  fill:#ffffff; /* mismo color que los iconos del player */
}

/* MINI‑PLAYER ESTILO SPOTIFY */
#floating-player {
  position: fixed;
  bottom: -200px;
  left: 0;
  width: 100%;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(14px);
  padding: 10px 16px 12px;
  box-sizing: border-box;
  box-shadow: 0 -2px 15px rgba(0,0,0,0.6);
  transition: bottom 0.35s ease;
  z-index: 999;
  border-top: 1px solid rgba(255,255,255,0.1);
}

.fp-top-row {
  display:flex;
  align-items:center;
  justify-content:space-between;
}

.fp-content {
  display:flex;
  align-items:center;
  gap:12px;
  flex:1;
}

#fp-cover {
  width:55px;
  height:55px;
  border-radius:6px;
  object-fit:cover;
}

.fp-text {
  flex:1;
  text-align:left;
  font-size:14px;
}

#fp-title {
  font-weight:bold;
  color:#fff;
}

/* Botón cerrar arriba a la derecha */
#fp-close {
  background: transparent;
  border: none;
  color: #fff;
  font-size: 20px;
  cursor: pointer;
  padding: 4px;
}

/* Botón colapsar (flecha abajo), solo visible en expandido */
#fp-collapse {
  background: transparent;
  border: none;
  color: #fff;
  font-size: 20px;
  cursor: pointer;
  padding: 4px;
  display:none;
}

/* Fila de controles debajo del título */
.fp-controls-row {
  display:flex;
  align-items:center;
  justify-content:center;
  gap:18px;
  margin-top:8px;
}

.fp-btn {
  background:transparent;
  border:none;
  cursor:pointer;
  padding:4px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.fp-btn svg {
  width:20px;
  height:20px;
  fill:#ffffff;
  opacity:0.9;
}

.fp-btn.small svg {
  width:18px;
  height:18px;
}

/* Botones de modos activos (repetir / aleatorio) */
.fp-btn.toggle.active svg {
  opacity:1;
  fill:#ffd966; /* resalta modo activo */
}

/* Barra de progreso personalizada */
#fp-progress-container {
  width: 100%;
  height: 8px;
  background: rgba(255,255,255,0.12);
  border-radius: 4px;
  margin-top: 10px;
  cursor: pointer;
  overflow: hidden;
  position:relative;
}

#fp-progress {
  width: 0%;
  height: 100%;
  background: rgba(255,255,255,0.8);
  transition: width 0.05s linear;
}

/* Puntero de progreso (thumb) */
#fp-progress-thumb {
  position:absolute;
  top:50%;
  left:0%;
  transform:translate(-50%, -50%);
  width:12px;
  height:12px;
  border-radius:50%;
  background:#ffffff;
  box-shadow:0 0 4px rgba(0,0,0,0.6);
}

/* Animación de salida del título hacia la izquierda */
.fp-title-exit-left {
  animation: titleExitLeft 0.35s forwards ease;
}

@keyframes titleExitLeft {
  0% { opacity: 1; transform: translateX(0); }
  100% { opacity: 0; transform: translateX(-30px); }
}

/* Entrada desde la derecha */
.fp-title-enter-left {
  animation: titleEnterLeft 0.35s forwards ease;
}

@keyframes titleEnterLeft {
  0% { opacity: 0; transform: translateX(30px); }
  100% { opacity: 1; transform: translateX(0); }
}

/* Animación de salida del título hacia la derecha (para anterior) */
.fp-title-exit-right {
  animation: titleExitRight 0.35s forwards ease;
}

@keyframes titleExitRight {
  0% { opacity: 1; transform: translateX(0); }
  100% { opacity: 0; transform: translateX(30px); }
}

/* Entrada desde la izquierda (para anterior) */
.fp-title-enter-right {
  animation: titleEnterRight 0.35s forwards ease;
}

@keyframes titleEnterRight {
  0% { opacity: 0; transform: translateX(-30px); }
  100% { opacity: 1; transform: translateX(0); }
}

/* Modo expandido */
#floating-player.expanded {
  height: 70vh;
  border-radius: 20px 20px 0 0;
  padding-top: 18px;
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
}

#floating-player.expanded .fp-top-row {
  align-items:flex-start;
}

/* Flecha abajo visible solo en expandido */
#floating-player.expanded #fp-collapse {
  display:block;
}

/* Contenido en columna centrada en expandido */
#floating-player.expanded .fp-content {
  flex-direction:column;
  align-items:center;
  text-align:center;
}

#floating-player.expanded #fp-cover {
  width:160px;
  height:160px;
  margin-bottom:8px;
}

#floating-player.expanded .fp-text {
  text-align:center;
}

#floating-player.expanded .fp-controls-row {
  margin-top:16px;
}

#floating-player.expanded #fp-progress-container {
  margin-top:16px;
}

/* Evitar que el click en elementos con esta clase expanda el player */
.no-expand {
  pointer-events:auto;
}

</style>
</head>

<body>

<div class="album">

  <!-- PORTADA ÁLBUM -->
  <img class="cover" src="../img/portadaWarmthOfChristmas.png" alt="Portada The Warmth Of Christmas">
  <h1 class="album-title">The Warmth Of Christmas</h1>

  <!-- IMPORTANTE: para añadir canciones, duplica bloques .track como estos
       y solo cambia:
       - data-file  → nombre del archivo de audio
       - data-cover → portada (si quieres otra) o deja la misma
       - texto dentro de .track-title
       - href del enlace de descarga
  -->

  <!-- CANCIÓN 1 -->
  <div class="track" 
       data-file="01._So_This_Is_Christmas.MP3" 
       data-cover="../img/portadaWarmthOfChristmas.png">
    <div class="track-info">
      <img src="../img/portadaWarmthOfChristmas.png" alt="Portada tema 1">
      <div class="track-title">So This Is Christmas</div>
    </div>
    <a class="download-btn" 
       href="https://github.com/private-audio-shows-51q8/Music/releases/download/warmth_of_christmas/01.So.This.Is.Christmas.MP3" 
       download title="Descargar">
      <svg viewBox="0 0 24 24">
        <path d="M12 3v12.17l4.59-4.58L18 12l-6 6-6-6 1.41-1.41L11 15.17V3h1zM5 19h14v2H5z"/>
      </svg>
    </a>
  </div>

  <!-- CANCIÓN 2 -->
  <div class="track" 
       data-file="02.%20The%20Warmth%20Of%20Christmas.MP3" 
       data-cover="../img/portadaWarmthOfChristmas.png">
    <div class="track-info">
      <img src="../img/portadaWarmthOfChristmas.png" alt="Portada tema 2">
      <div class="track-title">The Warmth Of Christmas</div>
    </div>
    <a class="download-btn" 
       href="https://github.com/private-audio-shows-51q8/Music/releases/download/warmth_of_christmas/02.The.Warmth.Of.Christmas.MP3" 
       download title="Descargar">
      <svg viewBox="0 0 24 24">
        <path d="M12 3v12.17l4.59-4.58L18 12l-6 6-6-6 1.41-1.41L11 15.17V3h1zM5 19h14v2H5z"/>
      </svg>
    </a>
  </div>

</div>

<!-- MINI‑PLAYER FLOTANTE -->
<div id="floating-player">
  <div class="fp-top-row">
    <div class="fp-content">
      <img id="fp-cover" src="../img/portadaWarmthOfChristmas.png" alt="Portada mini player">
      <div class="fp-text">
        <div id="fp-title">Reproduciendo...</div>
      </div>
    </div>
    <div class="no-expand" style="display:flex; align-items:center; gap:6px;">
      <!-- Flecha abajo solo en modo expandido -->
      <button id="fp-collapse" onclick="collapsePlayer(event)">▼</button>
      <button id="fp-close" onclick="closePlayer()">✕</button>
    </div>
  </div>

  <div class="fp-controls-row">
    <!-- Anterior -->
    <button id="fp-prev" class="fp-btn no-expand" onclick="prevTrack()">
      <svg viewBox="0 0 24 24">
        <path d="M6 5v14h2V5H6zm3.5 7l8.5 7V5l-8.5 7z"/>
      </svg>
    </button>

    <!-- Play/Pausa -->
    <button id="fp-play" class="fp-btn no-expand">
      <svg id="fp-play-icon" viewBox="0 0 24 24">
        <path d="M8 5v14l11-7z"/>
      </svg>
    </button>

    <!-- Siguiente -->
    <button id="fp-next" class="fp-btn no-expand" onclick="nextTrack()">
      <svg viewBox="0 0 24 24">
        <path d="M16 5v14h-2V5h2zM6 5v14l8.5-7L6 5z"/>
      </svg>
    </button>

    <!-- Repetir -->
    <button id="fp-repeat" class="fp-btn small no-expand toggle" onclick="toggleRepeat()">
      <svg viewBox="0 0 24 24">
        <path d="M7 7h9v2l3-3-3-3v2H6a3 3 0 0 0-3 3v4h2V8a1 1 0 0 1 1-1zm10 10H8v-2l-3 3 3 3v-2h10a3 3 0 0 0 3-3v-4h-2v4a1 1 0 0 1-1 1z"/>
      </svg>
    </button>

    <!-- Aleatorio (icono más claro) -->
    <button id="fp-shuffle" class="fp-btn small no-expand toggle" onclick="toggleShuffle()">
      <svg viewBox="0 0 24 24">
        <path d="M4 4h3.5l3 4.5-2 3L4 4zm5.5 0H14l2 3h-2.5L9.5 4zm5 7H17l3 4h-3.5l-3-4.5 2-2.5zM4 16h3.5l2-3 1.5 2.5L9.5 20H4v-4z"/>
      </svg>
    </button>
  </div>

  <audio id="player"></audio>

  <div id="fp-progress-container" class="no-expand">
    <div id="fp-progress"></div>
    <div id="fp-progress-thumb"></div>
  </div>
</div>

<script>
/* CONFIGURACIÓN POR ÁLBUM
   Cambia solo estas 2 constantes para reutilizar el código:
   - audioBasePath  → carpeta donde están los .MP3 de este álbum
   - defaultCover   → portada por defecto del álbum
*/
const audioBasePath = "../audio/Warmth_Of_Christmas/";
const defaultCover  = "../img/portadaWarmthOfChristmas.png";

/* Playlist se genera automáticamente leyendo el HTML de .track */
const trackElements = Array.from(document.querySelectorAll(".track"));
let currentIndex = -1;
let repeat = false;
let shuffle = false;

const player = document.getElementById("player");
const floatingPlayer = document.getElementById("floating-player");
const fpTitle = document.getElementById("fp-title");
const fpCover = document.getElementById("fp-cover");
const fpPlayBtn = document.getElementById("fp-play");
const fpPlayIcon = document.getElementById("fp-play-icon");
const fpRepeatBtn = document.getElementById("fp-repeat");
const fpShuffleBtn = document.getElementById("fp-shuffle");
const fpProgress = document.getElementById("fp-progress");
const fpProgressThumb = document.getElementById("fp-progress-thumb");
const fpProgressContainer = document.getElementById("fp-progress-container");

let isDraggingProgress = false;

/* Asignar click a cada track de la lista */
trackElements.forEach((trackEl, index) => {
  const info = trackEl.querySelector(".track-info");
  info.addEventListener("click", () => playIndex(index, "forward"));
});

/* Obtener datos de un track a partir del índice */
function getTrackData(index){
  const el = trackElements[index];
  return {
    file: el.dataset.file,
    cover: el.dataset.cover || defaultCover,
    title: el.querySelector(".track-title").textContent.trim()
  };
}

/* Reproducir por índice, con dirección para animación:
   direction: 'forward' (lista / siguiente) o 'backward' (anterior) */
function playIndex(index, direction = "forward"){
  currentIndex = index;
  const track = getTrackData(index);

  // Animaciones de título según dirección
  fpTitle.classList.remove(
    "fp-title-enter-left",
    "fp-title-exit-left",
    "fp-title-enter-right",
    "fp-title-exit-right"
  );

  if (direction === "backward") {
    fpTitle.classList.add("fp-title-exit-right");
  } else {
    fpTitle.classList.add("fp-title-exit-left");
  }

  setTimeout(() => {
    fpTitle.textContent = track.title;

    fpTitle.classList.remove(
      "fp-title-enter-left",
      "fp-title-exit-left",
      "fp-title-enter-right",
      "fp-title-exit-right"
    );

    if (direction === "backward") {
      fpTitle.classList.add("fp-title-enter-right");
    } else {
      fpTitle.classList.add("fp-title-enter-left");
    }
  }, 200);

  fpCover.src = track.cover || defaultCover;

  player.src = audioBasePath + track.file;
  player.play();
  updatePlayIcon(true);

  setDynamicGradient(track.cover || defaultCover);

  floatingPlayer.style.bottom = "0px";
}

/* Cerrar reproductor */
function closePlayer(){
  player.pause();
  const height = floatingPlayer.offsetHeight;
  floatingPlayer.style.bottom = `-${height}px`;
}

/* Colapsar desde expandido con flecha abajo */
function collapsePlayer(event){
  event.stopPropagation();
  floatingPlayer.classList.remove("expanded");
}

/* Gradiente dinámico según portada */
function setDynamicGradient(imageSrc){
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.src = imageSrc;

  img.onload = function(){
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img, 0, 0);

    const c1 = ctx.getImageData(10, 10, 1, 1).data;
    const c2 = ctx.getImageData(img.width/2, img.height/2, 1, 1).data;
    const c3 = ctx.getImageData(img.width-10, img.height-10, 1, 1).data;

    const col1 = `rgba(${c1[0]}, ${c1[1]}, ${c1[2]}, 0.6)`;
    const col2 = `rgba(${c2[0]}, ${c2[1]}, ${c2[2]}, 0.6)`;
    const col3 = `rgba(${c3[0]}, ${c3[1]}, ${c3[2]}, 0.6)`;

    floatingPlayer.style.background =
      `linear-gradient(135deg, ${col1}, ${col2}, ${col3})`;
  };
}

/* Barra de progreso + drag seguro sin expandir */
player.addEventListener("timeupdate", () => {
  if (!player.duration || isDraggingProgress) return;
  const percent = (player.currentTime / player.duration) * 100;
  fpProgress.style.width = percent + "%";
  fpProgressThumb.style.left = percent + "%";
});

function seekFromClientX(clientX){
  const rect = fpProgressContainer.getBoundingClientRect();
  let x = clientX - rect.left;
  x = Math.max(0, Math.min(rect.width, x));
  const percent = x / rect.width;
  if (player.duration) {
    player.currentTime = percent * player.duration;
  }
  const percent100 = percent * 100;
  fpProgress.style.width = percent100 + "%";
  fpProgressThumb.style.left = percent100 + "%";
}

fpProgressContainer.addEventListener("mousedown", (e) => {
  e.stopPropagation();  // no expandir
  isDraggingProgress = true;
  seekFromClientX(e.clientX);
});

document.addEventListener("mousemove", (e) => {
  if (!isDraggingProgress) return;
  seekFromClientX(e.clientX);
});

document.addEventListener("mouseup", () => {
  if (isDraggingProgress) {
    isDraggingProgress = false;
  }
});

/* Soporte táctil básico */
fpProgressContainer.addEventListener("touchstart", (e) => {
  e.stopPropagation();
  isDraggingProgress = true;
  const touch = e.touches[0];
  seekFromClientX(touch.clientX);
}, {passive:true});

document.addEventListener("touchmove", (e) => {
  if (!isDraggingProgress) return;
  const touch = e.touches[0];
  seekFromClientX(touch.clientX);
}, {passive:true});

document.addEventListener("touchend", () => {
  if (isDraggingProgress) {
    isDraggingProgress = false;
  }
});

/* Siguiente / anterior */
function nextTrack(){
  if (trackElements.length === 0) return;
  const nextIndex = (currentIndex + 1 + trackElements.length) % trackElements.length;
  playIndex(nextIndex, "forward");
}

function prevTrack(){
  if (trackElements.length === 0) return;
  const prevIndex = (currentIndex - 1 + trackElements.length) % trackElements.length;
  playIndex(prevIndex, "backward");
}

/* Repetir / aleatorio */
function toggleRepeat(){
  repeat = !repeat;
  if (repeat) {
    fpRepeatBtn.classList.add("active");
  } else {
    fpRepeatBtn.classList.remove("active");
  }
}

function toggleShuffle(){
  shuffle = !shuffle;
  if (shuffle) {
    fpShuffleBtn.classList.add("active");
  } else {
    fpShuffleBtn.classList.remove("active");
  }
}

player.addEventListener("ended", () => {
  if(repeat){
    playIndex(currentIndex, "forward");
    return;
  }

  if(shuffle){
    const randomIndex = Math.floor(Math.random() * trackElements.length);
    playIndex(randomIndex, "forward");
    return;
  }

  nextTrack();
});

/* Play / pausa */
function updatePlayIcon(isPlaying){
  if (isPlaying) {
    // icono pausa
    fpPlayIcon.innerHTML = '<path d="M7 5h3v14H7zM14 5h3v14h-3z"/>';
  } else {
    // icono play
    fpPlayIcon.innerHTML = '<path d="M8 5v14l11-7z"/>';
  }
}

fpPlayBtn.addEventListener("click", (e) => {
  e.stopPropagation(); // no expandir
  if (player.paused) {
    player.play();
    updatePlayIcon(true);
  } else {
    player.pause();
    updatePlayIcon(false);
  }
});

/* Sincronizar icono play/pausa con el propio audio */
player.addEventListener("play", () => updatePlayIcon(true));
player.addEventListener("pause", () => updatePlayIcon(false));

/* Modo expandido: click en la barra excepto elementos .no-expand */
floatingPlayer.addEventListener("click", (e) => {
  if (e.target.closest(".no-expand")) return;
  floatingPlayer.classList.toggle("expanded");
});
</script>

</body>
</html>
